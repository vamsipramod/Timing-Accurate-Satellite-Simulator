

CXX = g++
CXX_ARGS = -std=c++17 -DNDEBUG -O3 -g 

NANOLOG_RUNTIME_DIR= ./NanoLog/runtime
NANOLOG_LIB= ./NanoLog/runtime/libNanoLog.a

INCLUDES= -I$(NANOLOG_RUNTIME_DIR)
LIBS = -lelf -L -lNanoLog -pthread -lrt

all:nano satsim

nano:
ifneq ("$(wildcard $(NANOLOG_LIB))","./NanoLog/runtime/libNanoLog.a")
	$(wildcard $(NANOLOG_LIB))
	$(MAKE) -C $(NANOLOG_RUNTIME_DIR)
endif

OBJS = satsim.o core.o fetch.o decode.o execute.o reg_access.o mem_access.o exception.o write_back.o reg.o instruction.o elf_reader.o

$(OBJS): %o : %cpp
		$(CXX) -I $(NANOLOG_RUNTIME_DIR) -c -o $@ $< $(LIBS)

satsim : $(OBJS)
		$(CXX) $(CXX_ARGS) $(INCLUDES) $(OBJS) $(NANOLOG_LIB) -o satsim $(LIBS)

clean :	
		rm -f *.o *.log satsim

clean-all: clean
	@rm -f libNanoLog.a decompressor Makefile
	$(MAKE) clean-all -C $(NANOLOG_RUNTIME_DIR)
